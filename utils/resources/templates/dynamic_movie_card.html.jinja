<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<style>
@import url(https://fonts.googleapis.com/css?family=Lato:400,700);

*, *:before, *:after {
  box-sizing: border-box;
}

body {
  margin: 0;
  padding: 0;
  background: transparent;
  width: fit-content;
  height: fit-content;
  display: block;
  font-family: 'Lato', sans-serif;
}

.movie-card {
  font: 14px/22px "Lato", Arial, sans-serif;
  color: #A9A8A3;
  width: 600px;
  background: transparent;
}

.container {
  margin: 0;
  width: 100%;
  background: #FFFFFF;
  border-radius: 12px;
  position: relative;
  overflow: hidden; 
  box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}

/* Hero Section */
.hero {
  height: 260px; 
  margin: 0;
  position: relative;
  z-index: 1;
  background: url('{{ cover }}');
  background-size: cover;
  background-position: center;
}

.hero:before {
  content:'';
  width:100%; height:100%;
  position:absolute;
  top:0; left:0;
  background: linear-gradient(to bottom, rgba(0,0,0,0.1), rgba(0,0,0,0.4));
}

/* Avatar */
.cover {
  position: absolute;
  top: 200px; 
  left: 20px;
  z-index: 3;
  width: 100px;
  height: 100px;
  border-radius: 50%; 
  box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  object-fit: cover;
  background: #fff;
  border: 4px solid #fff; 
}

/* Description Section */
.description {
  background: #fff;
  padding: 50px 24px 24px 24px;
  color: #555;
  position: relative;
  z-index: 2;
}

.row-title {
    font-size: 22px;
    font-weight: 700;
    color: #1a1a1a;
    line-height: 1.4;
    margin-bottom: 12px;
}

.row-meta {
    font-size: 14px;
    color: #888;
    margin-bottom: 16px;
    display: flex;
    justify-content: space-between; 
    align-items: center;
}

.meta-left {
    display: flex;
    align-items: center;
    gap: 10px;
}

.username {
    color: #fb7299;
    font-weight: bold;
    font-size: 18px;
}

.tag {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: bold;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.tag-dynamic {
    background: #e5f5fa;
    color: #00a1d6;
}

.time {
    color: #bbb;
    font-size: 12px;
}

.content-text {
    font-size: 16px;
    line-height: 1.7;
    color: #333;
    margin-bottom: 20px;
    white-space: pre-wrap;
    word-break: break-all;
}

/* Image Grid */
.image-grid {
    display: grid;
    gap: 8px;
    margin-top: 16px;
    width: 100%;
}

/* Layout for different image counts */
.grid-1 { grid-template-columns: 1fr; }
.grid-2 { grid-template-columns: 1fr 1fr; }
.grid-3 { grid-template-columns: 1fr 1fr 1fr; }
.grid-4 { grid-template-columns: 1fr 1fr; }
.grid-5, .grid-6 { grid-template-columns: 1fr 1fr 1fr; }
.grid-7, .grid-8, .grid-9 { grid-template-columns: 1fr 1fr 1fr; }

.grid-item {
    width: 100%;
    aspect-ratio: 1 / 1;
    object-fit: cover;
    border-radius: 8px;
    background: #f4f4f4;
}

/* Special Case for single image if it's not square */
.grid-1 .grid-item {
    aspect-ratio: auto;
    max-height: 500px;
}

.repost-block {
    margin-top: 16px;
    padding: 16px;
    background: #f8f9fa;
    border-radius: 8px;
    font-size: 14px;
    color: #666;
    border: 1px solid #eee;
}

.repost-user {
    color: #00a1d6;
    font-weight: bold;
    margin-bottom: 8px;
    display: block;
}

</style>
</head>
<body>

<div class="movie-card">
  <div class="container">
    
    <!-- Hero (Background of first image or placeholder) -->
    <div class="hero"></div>
    
    <!-- Avatar -->
    <img src="{{ post.avatar }}" alt="avatar" class="cover" />
    
    <div class="description">
        
        <div class="row-meta">
            <div class="meta-left">
                <span class="username">{{ post.nickname }}</span>
                <span class="tag tag-dynamic">BILIBILI OPUS</span>
            </div>
            <span class="time">{{ date_str }}</span>
        </div>

        {% if post.title %}
        <div class="row-title">{{ post.title }}</div>
        {% endif %}
        
        <div class="content-text">{% if post.repost %}{{ post.repost.content }}{% else %}{{ post.content }}{% endif %}</div>

        <!-- Multi-image Grid -->
        {% set display_images = post.images %}
        {% if post.repost and post.repost.images %}
            {% set display_images = post.repost.images %}
        {% endif %}

        {% if display_images and display_images|length > 0 %}
            {% set img_count = display_images|length %}
            <div class="image-grid grid-{{ img_count if img_count <= 9 else 9 }}">
                {% for img in display_images[:9] %}
                    <img src="{{ img }}" class="grid-item" alt="post image">
                {% endfor %}
            </div>
        {% endif %}
        
        {% if post.repost %}
        <div class="repost-block">
            <span class="repost-user">@{{ post.repost.nickname }}</span>
            {{ post.repost.content }}
        </div>
        {% endif %}
        
    </div>
  </div>
</div>

</body>
</html>
